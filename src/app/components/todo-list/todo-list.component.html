<div class="container">
    <h1>üìù Angular Todo App</h1>

    <!-- Todo Form -->
    <app-todo-form (todoAdded)="addTodo($event.todo, $event.userId)"></app-todo-form>

    <!-- Filters -->
    <div class="filters">
        <h3>üîç B·ªô l·ªçc</h3>
        <div class="filter-row">
            <div class="form-group">
                <label>L·ªçc theo User ID:</label>
                <input
                    type="number"
                    [(ngModel)]="selectedUserId"
                    (change)="onFilterChange()"
                    placeholder="Nh·∫≠p User ID (1-30)"
                />
            </div>

            <div class="form-group">
                <label>Tr·∫°ng th√°i:</label>
                <select [(ngModel)]="filterCompleted" (change)="onFilterChange()">
                    <option value="all">T·∫•t c·∫£</option>
                    <option value="completed">ƒê√£ ho√†n th√†nh</option>
                    <option value="pending">Ch∆∞a ho√†n th√†nh</option>
                </select>
            </div>

            <div class="form-group">
                <label>S·ªë items m·ªói trang:</label>
                <select [(ngModel)]="itemsPerPage" (change)="onFilterChange()">
                    <option [value]="5">5</option>
                    <option [value]="10">10</option>
                    <option [value]="20">20</option>
                    <option [value]="30">30</option>
                </select>
            </div>
        </div>

        <div style="margin-top: 15px">
            <button class="btn-warning" (click)="getRandomTodo()">üé≤ L·∫•y Random Todo</button>
        </div>
    </div>

    <!-- Error Message -->
    <div *ngIf="error" class="error">‚ùå {{ error }}</div>

    <!-- Loading State -->
    <div *ngIf="loading" class="loading">‚è≥ ƒêang t·∫£i...</div>

    <!-- Todo List -->
    <div *ngIf="!loading">
        <h3>üìã Danh s√°ch Todos ({{ totalItems }} items)</h3>

        <ul class="todo-list" *ngIf="todos.length > 0">
            <li *ngFor="let todo of todos" class="todo-item" [class.completed]="todo.completed">
                <div class="todo-content">
                    <!-- Edit Mode -->
                    <div *ngIf="editingTodoId === todo.id">
                        <input
                            type="text"
                            [(ngModel)]="editTodoText"
                            (keyup.enter)="saveEdit(todo.id)"
                            (keyup.escape)="cancelEdit()"
                        />
                    </div>

                    <!-- View Mode -->
                    <div *ngIf="editingTodoId !== todo.id">
                        <div class="todo-text">
                            {{ todo.todo }}
                            <span
                                class="status-badge"
                                [class.status-completed]="todo.completed"
                                [class.status-pending]="!todo.completed"
                            >
                                {{ todo.completed ? '‚úì Ho√†n th√†nh' : '‚óã Ch∆∞a xong' }}
                            </span>
                        </div>
                        <div class="todo-meta">ID: {{ todo.id }} | User ID: {{ todo.userId }}</div>
                    </div>
                </div>

                <div class="todo-actions">
                    <!-- Edit Mode Actions -->
                    <ng-container *ngIf="editingTodoId === todo.id">
                        <button class="btn-success" (click)="saveEdit(todo.id)">üíæ L∆∞u</button>
                        <button class="btn-secondary" (click)="cancelEdit()">‚ùå H·ªßy</button>
                    </ng-container>

                    <!-- View Mode Actions -->
                    <ng-container *ngIf="editingTodoId !== todo.id">
                        <button class="btn-success" (click)="toggleComplete(todo)">
                            {{ todo.completed ? '‚Ü©Ô∏è Ch∆∞a xong' : '‚úì Ho√†n th√†nh' }}
                        </button>
                        <button class="btn-warning" (click)="startEdit(todo)">‚úèÔ∏è S·ª≠a</button>
                        <button class="btn-danger" (click)="deleteTodo(todo.id)">üóëÔ∏è X√≥a</button>
                    </ng-container>
                </div>
            </li>
        </ul>

        <div *ngIf="todos.length === 0" style="text-align: center; padding: 40px; color: #6c757d">
            Kh√¥ng c√≥ todo n√†o
        </div>

        <!-- Pagination -->
        <div class="pagination" *ngIf="totalPages > 1">
            <button
                class="btn-secondary"
                [disabled]="!hasPrevPage"
                (click)="changePage(currentPage - 1)"
            >
                ‚Üê Tr∆∞·ªõc
            </button>

            <span>Trang {{ currentPage }} / {{ totalPages }}</span>

            <button
                class="btn-secondary"
                [disabled]="!hasNextPage"
                (click)="changePage(currentPage + 1)"
            >
                Sau ‚Üí
            </button>
        </div>
    </div>
</div>
